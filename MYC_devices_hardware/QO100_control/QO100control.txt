Hinweis für die Textformat-Version; um diese Version im PDF Format zu lesen, laden Sie bitte http://www.dk1ri.de/dhw/powerschalter.pdf

MYC QO100 Trx Steuerung

Author DK1RI, Version V02.2, 20240410
This project can be found in https://www.github.com/dk1ri also.

Einleitung

Dieses Device steuert die Stromversorgung meiner QO100 Station für SSB und DATV Betrieb.
Die Steuerung erfolgt über USB.
Diese Steuerung kann in einem MYC System verwendet werden, aber auch unabhängig davon mit (binären) Befehlen oder mit einem Browser gesteuert werden. Die Befehle sind sind als announcements in der Datei announcements.bas im Bascom Programm beschrieben. Auch ohne USB Schnittstelle kann der NB/WB Mode und die PTT mit zwei Schaltern geschaltet werden.
Zur Steuerung mit einem Browser: siehe [7].
Die Hardware der Steuerung kann mehr Funktionen steuern, als zur Zeit verwende; aber alle Anschlüsse sind steuerbar.
Details siehe unter Anschlüsse.

Beschreibung

Die Eagledaten stehen bei [1].
Diese Beschreibung gilt für meinen aktuellen Betrieb.
Nach dem Einschalten sind GPS, und Pluto NB eingeschaltet. Nach circa 2 Sekunden ist Betrieb möglich, allerdings benötigt der von mir verwendete GPS Empfänger ca 15 Minuten zur Synchronisation.
Nach einer NB / WB Umschaltung ist die Sendefunktion immer abgeschaltet.
Der Upconverter benötigt ca 2 Sekunden zum Starten. Nach dem Umschalten auf NB kann in dieser Zeit kein andrer Befehl eingegeben werden. 
Das Schalten der PTT und die Umschaltung auf WB dauert circa 200ms.
Im WB Betrieb läuft der Lüfter immer.
Die Stromversorgung erfolgt über den 12V Anschluss. Der Ruhestrom (ohne angeschlossene Geräte) beträgt circa 75mA.
Spannung an den Ausgängen (V):
			off	NB	WB	WBRX	NB mit PTT	WB mit PTT
Minitiouner		0	0	5	5		0		5
Koaxrelais		0	0	5	5		0		5
BiasT			0	12	17	17		12		17
13cmPATx		0	0	0	0		0		12
Fan			0	0	5	0		0		5
Pttout			0	0	0	0		5		0
USB 1WPPA1		0	0	5	0		0		5
USB 1WPA2		0	0	5	0		0		5
USB Pluto_WB	0	0	5	0		0		5
Upconverter		0	12	0	0		12		0
12VDATV		0	0	12	0		0		12
28DATV_1 (20A)	0	0	28	28		0		28
28DATV_2 (5A)	0	0	28	0		0		28

GPS, 5V und USB Pluto_NB: immer 5V.
Die Abfrage der Werte des Upconverter funktioniert nicht. Der Grund ist unklar.

Einbindung in das MYC System

Details zum MYC System stehen in [3].
Die komplette Befehlsliste steht als  announcements in der Datei announcements.bas im Bascom Programm.

Fehlermeldungen

Der Befehl &HFC liefert den letzten Fehler im Format:
aktuelle Befehlsnummer - Fehler - Befehlsnummer beim Auftritt des Fehlers
Dazu werden die empfangenen Befehle von 0 bis 255 umlaufend gezählt.
Nach 254 korrekten Befehlen wird der Fehlereintrag gelöscht.

Hardware Reset

Ist der Reset Jumper JP5 beim Anlegen der Versorgungsspannung überbrückt, werden wieder die Defaultwerte eingelesen.

Watchdog

Es gibt einen kompletten Hardware-reset, wenn die Hauptschleife länger als 2 Sekunde dauert. Zusätzlich gibt es drei weitere Watchdogs, die in der vorliegenden Firmware für Tests und „nicht_MYC Betrieb“ nach ca 10 Sekunden ansprechen. Für „MYC Betrieb“ sollte der Wert auf 1 Sekunde gesetzt werden.
Die Befehlseingabe und Ausführung muss in dieser Zeit beendet sein. Danach werden die bereits empfangenen Daten gelöscht. Dies soll falsche Eingaben vermeiden. Mit dem &HFC "letzten Fehler" Befehl kann man Eingabefehler sehen.

Firmware

Die Steuerung übernimmt ein AVR Mikrocontroller Atmega1284
Das aktuelle Bascom Programm verwendet einen Atmega1284.
Die Firmware wurde in BASCOM geschrieben [2].
Um das Programm zu kompilieren, muss das Verzeichnis common_1.13 [6] in das Verzeichnis mit dem Programm kopiert werden

Programmierung des Prozessors

Zur Programmierung des Prozessors ist ein 6poliger ISP Stecker JP6 vorgesehen.
Die Fuses müssen möglicherweise programmiert werden (siehe Bascom Programm) !! Prozessortyp und Frequenz müssen gegebenenfalls angepasst werden.
JTAG muss abgeschaltet werden.
Der Jumper J1 sollte während der Programmierung entfernt werden.

Serielle RS232 / USB Schnittstelle

RS232 Schnittstelle zur Steuerung des Upconverters: Schnittstellenparameter: 9k6 8N1. Die alte Firmware des Upconverter verwendet 115kB/s!!
Steuerung des gesamten Devices: Es wird die USB Platine UM2102 von ELV verwendet.
Die USB Platine wird plan auf der Oberseite der Interfaces verlötet: der USB Stecker zeigt zum Rand. Die mittleren 4 pins des Verbinders ST2  sind mit dem 4 Anschlusspunkten JP7 auf dem Interface zu verbinden. USB Platine und Device müssen voneinander isoliert werden.

Browser Schnittstelle

Es gibt einen (Windows) Webserver, an den das Device über USB angeschlossen wird. Die Bedienung erfolgt mit einem Browser, der auf den Webserver zugreift.
Details dazu stehen in [7].
Ein Bildschirm Bild und nötige Daten für dieses Device stehen in [8].

SMD

Die Leiterplatte ist teilweise mit SMD bestückt.

Bestückung der Leiterplatte 

Verwendung von ISP: JP6
Als externer Temperatursensor wird ein LM135Z verwendet, der an JP10 pin1 / 2 angeschlossen wird
Die LED wird nur für Test verwendet. R20 – R27, C30 – C38 schützen die Eingänge des Prozessors. Die Werte müssen an die Funktion und die verwendete Leitungslänge angepasst werden.

Anschlüsse

X1:
1: 	28V GND 		28V /20A Netzteil
2: 	28V_in		28V /20A Netzteil
3: 	28V GND		für  DATV PA
4: 	28VDATV_1		für  DATV PA; dass verwendete Relais schaltet bis zu 16A

X2:
1: 	28V GND		nicht verwendet
2: 	28VDATV_2		nicht verwendet
3: 	12V GND		für Kuhne Upconverter
4: 	Upconverter		für Kuhne Upconverter; 12V 7A bei 20W output

X3:
1: 	12V GND 		12V / 20A Netzteil
1: 	12V_in 		12V / 20A Netzteil
3: 	12V GND		12V DATV
3: 	12VDATV		12V DATV

X5: 
5V 	USB			für PlutoNB

X6: 
5V	 USB			für PlutoWB

X7: 
5V 	USB			für 1W PA 1

X8: 
5V 	USB			für 1W PA 2

JP9:
1	GND			? pin5 RS232
2	RX 			(vom Upconverter)	? pin3 RS232
3	TX 			(zum Upconverter)	? Pin2 RS232

JP10; Temp
1: 	GND			für externen Temperatursensor LM135Z
2: 	Signal			für externen Temperatursensor LM135Z
3; 	5V			für externen Temperatursensor LM135Z 
Wenn R20  bestückt ist, wird JP10 pin3 nicht verwendet

JP11: in_F/R
1: 	GND
2: 	F			SWR 10W PA (nicht verwendet)
3: 	R			SWR 10W PA (nicht verwendet)

JP12: in_Kerr/T
1: 	GND
2: 	K_err			für 10W PA (nicht verwendet)
3: 	T			für 10W PA (nicht verwendet)

JP13: in_PA1/SWR
1: 	GND
2: 	PA1_1			nicht verwendet 
3: 	SWR			SWR 28V PA

JP14: PA2
1: 	GND
2: 	PA2_1			nicht verwendet
3: 	PA2_2			nicht verwendet

JP15: in_PTT_NB/WB
1: 	GND
2: 	PTT			externe PTT, „0“ aktiv
3: 	NB/WB		externe Umschaltung NB / WB NB: offen WB: verbunden mit GND

JP16: PTTout
1,2: 	GND
3: 	Pttout			für Upconverter

JP17: FAN
1,2: 	GND
3: 	Fan			für PA Lüfter	

JP18: 
1,2: 	GND
3: 	13cmPATX		TX für 13cm PA	

JP19: 5V
1,2: 	GND
3: 	5V			 für USB Hub

JP20: BiasT
1,2: 	GND
3: 	BiastT			Stromversorgung LNB
	
JP21: GPS
1,2: 	GND
3 	GPS			für GPS

JP22: Minitiouner
1,2: 	GND
3: 	Minitiouner		12V für Minitiouner	

JP23: Koaxrelais
1,2: 	Koaxrelais		für Koaxrelais
3: 	12V			für Koaxrelais

weitere Jumper

JP1 		Power, während des normalen Betriebs muss der Jumper J1 gesteckt sein.
JP5		Reset
JP6		ISP
JP7		Anschluss für USB Modul

Versionen

Diese Beschreibung gilt für die
Leiterplattenversion 02.3
Bascom Version 01.2

Copyright

Die Ideen in diesem Dokument unterliegen der GPL (Gnu Public Licence V2) soweit keine früheren, anderen Rechte betroffen sind.
Die Verwendung der Unterlagen erfolgt auf eigene Gefahr; es wird keinerlei Garantie / Gewährleistung / Produkthaftung  übernommen.
The ideas of this document can be used under GPL (Gnu Public License V2) as long as no earlier other rights are affected.
The usage of this document is on own risk, there is no warranty.



Referenzen

1]	http://www.dk1ri.de/dhw/QO100_control_eagle.zip
[2] 	http://www.dk1ri.de/dhw/QO100_control_bascom.zip
[3]	dk1ri.de/myc/MYC.pdf 
[3]	https://www.dk1ri.de/myc/MYC.pdf 
[4]	https://dk1ri.de/myc/Description.txt  oder https://dk1ri.de/myc/Description.pdf (englisch)
[5]	https://dk1ri.de/myc/Definitions.txt  oder https://dk1ri.de/myc/Definitions.pdf (englisch)
[6]	https://dk1ri.de/dhw/common_1.13.zip
[7]	https://dk1ri.de/myc/webserver.pdf oder  https://dk1ri.de/myc/webserver.txt
[8]	https://dk1ri.de/w_dat.htm
