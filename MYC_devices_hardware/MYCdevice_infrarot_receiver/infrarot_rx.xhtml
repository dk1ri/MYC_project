<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!--This file was converted to xhtml by OpenOffice.org - see http://xml.openoffice.org/odf2xhtml for more info.--><head profile="http://dublincore.org/documents/dcmi-terms/"><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/><title xml:lang="en-US">DTMF RX</title><meta name="DCTERMS.title" content="DTMF RX" xml:lang="en-US"/><meta name="DCTERMS.language" content="en-US" scheme="DCTERMS.RFC4646"/><meta name="DCTERMS.source" content="http://xml.openoffice.org/odf2xhtml"/><meta name="DCTERMS.creator" content="DK1RI"/><meta name="DCTERMS.issued" content="2012-02-01T18:05:06.26" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.contributor" content="DK1RI"/><meta name="DCTERMS.modified" content="2015-11-17T17:30:21.71" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.provenance" content="" xml:lang="en-US"/><meta name="DCTERMS.subject" content="MYC," xml:lang="en-US"/><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" hreflang="en"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" hreflang="en"/><link rel="schema.DCTYPE" href="http://purl.org/dc/dcmitype/" hreflang="en"/><link rel="schema.DCAM" href="http://purl.org/dc/dcam/" hreflang="en"/><style type="text/css">
	@page {  }
	table { border-collapse:collapse; border-spacing:0; empty-cells:show }
	td, th { vertical-align:top; font-size:12pt;}
	h1, h2, h3, h4, h5, h6 { clear:both }
	ol, ul { margin:0; padding:0;}
	li { list-style: none; margin:0; padding:0;}
	<!-- "li span.odfLiEnd" - IE 7 issue-->
	li span. { clear: both; line-height:0; width:0; height:0; margin:0; padding:0; }
	span.footnodeNumber { padding-right:1em; }
	span.annotation_style_by_filter { font-size:95%; font-family:Arial; background-color:#fff000;  margin:0; border:0; padding:0;  }
	* { margin:0;}
	.P1 { font-size:12pt; font-family:Times New Roman; writing-mode:page; text-align:right ! important; }
	.P10 { font-size:12pt; font-family:Times New Roman; writing-mode:page; text-align:justify ! important; font-weight:normal; }
	.P3 { font-size:14pt; font-family:Times New Roman; writing-mode:page; text-align:center ! important; font-weight:bold; }
	.P4 { font-size:12pt; font-family:Times New Roman; writing-mode:page; font-weight:bold; }
	.P5 { font-size:12pt; font-family:Times New Roman; writing-mode:page; text-align:center ! important; font-weight:bold; }
	.P6 { font-size:12pt; font-family:Times New Roman; writing-mode:page; font-weight:normal; }
	.P7 { font-size:12pt; font-family:Times New Roman; writing-mode:page; text-align:justify ! important; }
	.P8 { font-size:12pt; font-family:Times New Roman; writing-mode:page; font-style:normal; font-weight:bold; }
	.P9 { font-size:12pt; font-family:Times New Roman; writing-mode:page; font-weight:normal; }
	.Standard { font-size:12pt; font-family:Times New Roman; writing-mode:page; }
	.Text_20_body { font-size:12pt; font-family:Times New Roman; writing-mode:page; margin-top:0cm; margin-bottom:0.212cm; }
	.Internet_20_link { color:#000080; text-decoration:underline; }
	.T1 { font-weight:bold; }
	.T2 { color:#0000ff; font-family:Times New Roman; font-size:10pt; text-decoration:underline; }
	.T3 { font-family:Times New Roman; font-size:12pt; }
	<!-- ODF styles with no properties representable as CSS -->
	{ }
	</style></head><body dir="ltr" style="max-width:21.001cm;margin-top:2cm; margin-bottom:2cm; margin-left:2cm; margin-right:2cm; "><p class="P3">Infrarot (RC5) Empfänger</p><p class="P5"> </p><p class="P9">Author DK1RI, Version V02.0, 20151117</p><p class="P9">This project can be found in <a href="https://github.com/dk1ri" class="Internet_20_link">https://github.com/dk1ri</a> also.</p><p class="P9"> </p><p class="P4">Einleitung</p><p class="P4"> </p><p class="Standard">Dieses Interface ist eine Konverter von Infrarot (RC5) Signalen auf MYC Protokoll über I2C (Slave) / RS232 / USB</p><p class="Standard">Im „no_myc“ Mode arbeitet das Interface als einfacher RC5 - ASCII Wandler.</p><p class="Standard"> </p><p class="P4">Beschreibung</p><p class="Standard"> </p><p class="Standard">Die Eagle Datenstehen unter  [1].</p><p class="Standard">Details zum MYC Protokoll stehen in [3]</p><p class="Standard"> </p><p class="Text_20_body">Die Befehle zur Steuerung müssen binär eingegeben werden; er erfolgt keine Wandlung.</p><p class="Text_20_body">MYC mode:</p><p class="Text_20_body">Im MYC mode erfolgt die Ausgabe der empfangenen RC5 Signale auf die RS232 /USB Schnittstelle immer als info, also:</p><p class="Text_20_body">&amp;H01&amp;Hnn<span> </span><span> n : 00 – 0F, FF (ungültig)</span></p><p class="Text_20_body">Werden Zeichen mit dem Lesebefehl an der seriellen Schnittstelle gelesen, sind diese nicht mehr gültig (also &amp;HFF), da diese ja bereits gesendet wurden.</p><p class="Text_20_body">Für die I2C Schnittstelle gilt:</p><p class="Text_20_body">- Der Lesebefehl zu Lesen der RC5 Codes hat keinerlei Funktion und kann daher ganz entfallen. Die Daten können vom Master direkt gelesen werden. Das Interface puffert 252 RC5 Zeichen, danach werden die ältesten überschrieben. Werden mehr Zeichen ausgelesen als vorhanden sind,, wird &amp;HFF ausgegeben.</p><p class="Text_20_body">- Die Zahl der gültigen RC5 Codes im I2C Puffer kann mit &amp;H02 angefordert werden. An der I2C Schnittstelle ist danach das nächste gelesene Byte diese Zahl.</p><p class="Text_20_body">- Bei der Ausführung eines anderen Lesebefehls wird der RC5 (I2C) Puffer gelöscht.</p><p class="Text_20_body">- Nach einem Lesebefehl müssen erst alle Daten abgerufen werden, bevor wieder RC5 Daten gespeichert werden, da beides im I2C Puffer gespeichert ist,</p><p class="Text_20_body">Nicht MYC mode:</p><p class="Text_20_body">Im nicht_MYC mode werden die Ziffern des RC5 Codes zweistellig auf die serielle Schnittstelle ausgegeben.</p><p class="Text_20_body">Die MYC Befehle funktionieren nicht. Zur Rückkehr in den MYC mode muss an der seriellen Schnittstelle &amp;H14 oder an der I2C Schnittstelle &amp;H1400 eingegeben werden.</p><p class="Text_20_body">Der nicht MYC mode hat auf die I2C Schnittstelle keinen Einfluss.</p><p class="Text_20_body"> </p><p class="P4">Befehle</p><p class="Standard"> </p><p class="Standard">Folgende Befehle werden von der I2C  / RS232 / USB Schnittstelle akzeptiert:</p><p class="Standard">Zu Details zum MYC Protokoll und zur Bedienung siehe [3]</p><p class="P7">Die Kommentare zu den Befehlen sind eine Kopie aus dem Bascom Programm:</p><p class="P7"> </p><p class="P7"> </p><p class="Standard">Befehl <span> </span><span> Parameter</span></p><p class="Standard">Announce0:</p><p class="Standard">'Befehl &amp;H00            <span> eigenes basic announcement lesen</span></p><p class="Standard">'                       <span> basic announcement is read to I2C or output</span></p><p class="Standard">Data "0;m;DK1RI;Infrared (RC5) receiver;V02.0;1;155;7;12"</p><p class="Standard">'</p><p class="Standard">Announce1:</p><p class="Standard">'Befehl  &amp;H01           <span> definiert den DTMF-Lesespeicher</span></p><p class="Standard">'                       <span> keine Funktion im I2C mode, seriell: liefert &amp;HFF</span></p><p class="Standard">'                        <span> defines the read buffer</span></p><p class="Standard">'                       <span> function in I2C mode, serial: &amp;HFF</span></p><p class="Standard">Data "1;af,RC5 buffer;b,0 to 63"</p><p class="Standard">'</p><p class="Standard">Announce2:</p><p class="Standard">'Befehl  &amp;H02           <span> liest Zahl der gueltigen Werte</span></p><p class="Standard">'                       <span> read number of valid data bytes</span></p><p class="Standard">Data "2;af,valid RC5 buffer length;b,0 to 252"</p><p class="Standard">'</p><p class="Standard">Announce3:</p><p class="Standard">'Befehl &amp;H03   0-31     RC5 Adresse schreiben</p><p class="Standard">'                       <span> write RC5 adress</span></p><p class="Standard">'Data "3;oa,rc5adress;b,0 to 31"</p><p class="Standard">Announce4:</p><p class="Standard">'Befehl &amp;H04            <span> RC5 Adresse lesen</span></p><p class="Standard">'                       <span> read RC5 adress</span></p><p class="Standard">'Data "4;oa,rc5adress;as3"</p><p class="Standard">'</p><p class="Standard">Announce5:</p><p class="Standard">'Befehl  &amp;H14           <span> schaltet MYC / no_MYC mode</span></p><p class="Standard">'                       <span> switches MYC / no_MYC mode</span></p><p class="Standard">Data "20;oa,no_myc;a"</p><p class="Standard">'</p><p class="Standard">Announce6:</p><p class="Standard">'Befehl  &amp;H15           <span> liest MYC / no_MYC mode</span></p><p class="Standard">'                       <span> read MYC / no_MYC mode</span></p><p class="Standard">Data "21;aa,as20"</p><p class="Standard">'</p><p class="Standard">Announce7:</p><p class="Standard">'Befehl &amp;HF0 :   0-13,</p><p class="Standard">'                253,254 255        announcement aller Befehle in I2C Puffer kopieren</p><p class="Standard">'                                   <span> announcement lines are read to I2C  or output</span></p><p class="Standard">Data "240;am,ANNOUNCEMENTS;100;12"</p><p class="Standard">'</p><p class="Standard">Announce8:                                                  '</p><p class="Standard">'&amp;HFC                      <span> Letzten Fehler in I2C Puffer kopieren oder ausgeben</span></p><p class="Standard">'                                   read last error</p><p class="Standard">Data "252;aa,LAST ERROR;20,last_error"</p><p class="Standard">'</p><p class="Standard">Announce9:                                                  '</p><p class="Standard">'Befehl &amp;HFD :     <span> eigene activ Meldung in I2C Puffer kopieren (&amp;H04) oder ausgeben</span></p><p class="Standard">'                               <span> Life signal</span></p><p class="Standard">Data "253;aa,MYC INFO;b,BUSY"</p><p class="Standard">'</p><p class="Standard">Announce10:</p><p class="Standard">'Befehl &amp;HFE :        *<span> </span><span> eiene Individualisierung schreiben</span></p><p class="Standard">'                               <span> Der Devicename &amp;HFE00 kann maximal 20 Zeichen haben</span></p><p class="Standard">'                                   Anderer Adresstyp &amp;HFE02 kann maximal 3 Zeichen haben.</p><p class="Standard">'                                   wird aber ignoriert.</p><p class="Standard">Data "254;oa,INDIVIDUALIZATION;20,NAME,Device 1;b,NUMBER,1;3,INTERFACETYPE,I2C;b,ADRESS,24;INTERFACETYPE,RS232;IF_PARAMETER1,9600Bd;IF_PARAMETER2,8n1;INTERFACETYPE,USB"</p><p class="Standard">'</p><p class="Standard">Announce11:</p><p class="Standard">'Befehl &amp;HFF :        0 – 3<span> eigene Individualisierung in I2C Puffer kopieren</span></p><p class="Standard">Data "255;aa;as254"</p><p class="Standard">'</p><p class="Standard"> * sh [3]</p><p class="Standard"> ** 1 schaltet alle Befehle ab, Die Eingabe von 0-9, A-F (a-f) bewirkt direkte DTMF Ausgabe</p><p class="Standard"><span> Funktioniert nur an der RS232 / USB Schnittstelle, keinen Einfluss auf die I2C Schnittstelle.</span></p><p class="Standard"><span> Rückkehr in dem default Befehlsmode mit &amp;H14. </span></p><p class="Standard"> </p><p class="P4">I2C</p><p class="Standard"> </p><p class="Standard">Die Default Adresse ist 6</p><p class="Standard">Mit dem Befehl &amp;HFE03&lt;n&gt; kann die Adresse in n (1 … 128) geändert werden.</p><p class="Standard">Pullup Widerstände für den I2C Bus (R8/R9) können bei Bedarf bestückt werden. Der Gesamtwiderstand am Bus sollte zwischen 1 und 10 kOhm liegen. </p><p class="Standard"> </p><p class="P4">Fehlermeldungen</p><p class="P4"> </p><p class="Standard">Der Befehl &amp;HFC liefert den letzten Fehler im Format:</p><p class="Standard">aktuelle Befehlsnummer - Fehler - Befehlsnummer beim Auftritt des Fehlers</p><p class="Standard">Dazu werden die empfangenen Befehle von 0 bis 255 umlaufend gezählt.</p><p class="Standard"> </p><p class="P4">Reset</p><p class="P4"> </p><p class="Standard">Ist der Reset Jumper JP4 beim Anlegen der Versorgungsspannung überbrückt, werden wieder die Defaultwerte eingelesen. Dies ist hilfreich, wenn die aktuelle I2C Adresse verloren gegangen ist.</p><p class="Standard"> </p><p class="P4">Watchdog</p><p class="Standard"> </p><p class="Standard">Die Befehlseingabe muss in weniger als 1 Sekunde beendet sein. Danach werden die bereits empfangenen Daten gelöscht. Dies soll falsche Eingaben vermeiden.  Mit dem "letzten Fehler" Befehl kann man Eingabefehler sehen. Er zeigt die aktuelle Befehlsnummer und die des Fehlers.</p><p class="Standard"> </p><p class="Standard"> </p><p class="Standard"> </p><p class="P4">Software</p><p class="P4"> </p><p class="Standard">Die Steuerung übernimmt ein AVR Mikrocontroller Atmega8.</p><p class="Standard">Die Software wurde in BASCOM geschrieben [2]</p><p class="Standard"> </p><p class="P4">Programmierung des Prozessors</p><p class="Standard"> </p><p class="Standard">Zur Programmierung des Prozessors ist ein 6poliger ISP Stecker vorhanden.</p><p class="Standard">Um der Prozessor von der Stromversorgung der übrigen Schaltung zu trennen, muss der Jumper JP1 entfernt werden.</p><p class="P9">Die Fuses müssen möglicherweise programmiert werden (sh Bascom Programm) !! Prozessortyp und Frequenz müssen ggf angepasst werden.</p><p class="P4"> </p><p class="P4">Infrarot Eingang</p><p class="Standard"> </p><p class="Standard">Am Infrarot Eingang muss ein geeigneter Empfänger SFH506 oder ähnlich angeschlossen werden.</p><p class="Standard">Bei mir funktionierte der TSOP1835, allerdings auch nur mit 22uF zwischen + und – und 47k Pullup direkt am Empfänger. Der Speisewiderstand ist 270 Ohm. Eine Begründung für dieses Verhalten fehlt.</p><p class="Standard"> </p><p class="P4">RS232 Schnittstelle</p><p class="Standard"> </p><p class="Standard">Bei Bedarf und entsprechender Bestückung kann auch die RS232/USB Schnittstelle zur Befehlseingabe verwendet  werden. Die Erkennung der aktiven Schnittstelle (I2C / seriell) erfolgt automatisch. Sofern ein Befehl nicht komplett gesendet wurde und die andere Schnittstelle sendet Daten, wird der alte Befehl abgebrochen. Daher kann eine gleichzeitige Verwendung beider Schnittstellen zu Fehlern führen.</p><p class="Standard">Schnittstellenparameter: 19k2 8N1</p><p class="Standard">Für RS232 muss bei Jumper JP7 und JP8 ist jeweils Pin1 und Pin2  überbrückt werden.</p><p class="P4"> </p><p class="P4">USB Schnittstelle</p><p class="Standard"> </p><p class="Standard">Das Interface kann alternativ mit der USB Platine UM2102 von ELV bestückt werden. Die USB Platine wird plan auf der Oberseite der Interfaces verlötet: der USB Stecker zeigt seitlich nach außen. Die mittleren 4 pins des Verbinders ST2  sind mit dem 4 poligen Verbinder JP9 auf dem Interface zu verbinden.USB Platine und Interface müssen voneinander isoliert werden.</p><p class="Standard">Die Stromversorgung erfolgt dann über USB.</p><p class="P10"> </p><p class="P4">SMD</p><p class="Standard"> </p><p class="Standard">Die Leiterplatte ist teilweise mit SMD bestückt. Bei den nötigen Bauteilen sind das aber nur relativ große Kondensatoren (1206).</p><p class="Standard"> </p><p class="P4">Stromversorgung</p><p class="Standard"> </p><p class="Standard">Die Stromversorgung ist 7- 15V, Stromaufnahme ca. 30mA. Bei Verwendung des USB Moduls erfolgt die Stromversorgung darüber. Die RS232 Buchse, die Stromversorgungsbuchse und der Spannungsregler dürfen dann nicht bestückt werden.</p><p class="Standard"> </p><p class="Standard"> </p><p class="P8">LEDs</p><p class="Standard"> </p><p class="Standard">Die LEDs müssen nicht bestückt werden. LED1 zeigt nur, daß der Prozessor läuft und blinkt.</p><p class="Standard">LED2 zeigt, daß ein Infrarot Signal empfangen wurde.</p><p class="Standard"> </p><p class="Standard"> </p><p class="P4">Bestückung der Leiterplatte</p><p class="Standard"> </p><p class="Standard">Da die Leiterplatte auch für andere Anwendungen eingesetzt werden kann, brauchen nur folgende Bauteile  bestückt werden:</p><p class="Standard">IC1, Q1 (8MHz), C3 – C6, JP1 (muss für Normalbetrieb überbrückt werden), </p><p class="Standard"> SL4</p><p class="Standard"> </p><p class="Standard">Verwendung von ISP:</p><p class="Standard">JP6</p><p class="Standard"> </p><p class="Standard">nur mit RS232 Schnittstelle:</p><p class="Standard">IC2, IC3, D1, C1, C2, C7 – C10, JP7, JP8 (jeweils Pin1 und Pin 2 überbrücken), X1, X4 (Buchse)</p><p class="Standard"> </p><p class="Standard">nur mit USB</p><p class="Standard">UM2102</p><p class="Standard"> </p><p class="Standard">nur I2C</p><p class="Standard">R8, R9 nach Bedarf, X2, X3, IC3, D1, C1, C2</p><p class="Standard"> </p><p class="Standard">Weitere Bestückung erleichtert Tests..</p><p class="Standard"> </p><p class="Standard"><span class="T1">Anschlüss</span>e</p><p class="Standard"> </p><p class="Standard">Power</p><p class="Standard">Tip<span> 12V</span></p><p class="Standard">Ring<span> GND</span></p><p class="Standard"> </p><p class="Standard">RS232 (Buchse)</p><p class="Standard">5<span> GND</span></p><p class="Standard">2<span> Jumper</span></p><p class="Standard">3<span> Jumper</span></p><p class="Standard"> </p><p class="Standard">I2C Stereo (2 x 3,5mm Klinke)</p><p class="Standard">Sleeve<span> GND</span></p><p class="Standard">Ring<span> SDA</span></p><p class="Standard">Tip<span> SCL</span></p><p class="Standard"> </p><p class="Standard">Infrarot (SL4)</p><p class="Standard">2<span> Infrarot Daten </span></p><p class="Standard">4<span> 5V</span></p><p class="Standard">5<span> GND</span></p><p class="Standard"> </p><p class="Standard"> </p><p class="Standard"> </p><p class="P4">Versionen</p><p class="Standard"> </p><p class="Standard">Diese Beschreibung gilt für die</p><p class="Standard">Leiterplattenversion 01.9</p><p class="Standard">Bascom Version 02.0</p><p class="P4"> </p><p class="P4"> </p><p class="P4"> </p><p class="P4">Copyright</p><p class="P4"> </p><p class="P6">Die Ideen in diesem Dokument unterliegen der GPL (Gnu Public Licence) soweit keine früheren, anderen Rechte betroffen sind.</p><p class="P6">Die Verwendung der Unterlagen erfolgt auf eigene Geafahr; es wird keinerlei Garantie übernommen.</p><p class="P6">The ideas of this document can be used under GPL (Gnu Public License) as long as no earlier other rights are affected.</p><p class="P6">The usage of this document is on own risk, there is no warranty.</p><p class="P6"> </p><p class="P4">Referenzen</p><p class="Standard"> </p><p class="Standard">[<span class="T3">[1]        </span><a href="http://www.dk1ri.de/common/myc/MYC_i2c_rs232_interface/i2c_rs232_interface_eagle_V01.9.zip" class="Internet_20_link"><span class="T2">i2_rs232_interface_eagle.zip</span></a></p><p class="Standard">[2]<span> <a href="http://www.dk1ri.de/common/myc/MYC_infrarot_rx/MYC_infrarot_rx_bascom.zip" class="Internet_20_link">infrarot_rx_bascom.zip</a></span></p><p class="Standard">[3]<span> <a href="http://www.dk1ri.de/common/myc/MYC_basic/MYC.pdf" class="Internet_20_link">MYC.pdf</a></span></p><p class="Standard"> </p></body></html>