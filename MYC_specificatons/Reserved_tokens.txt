MYC Reserved Commands

Author: DK1RI
Version V01.15 20161101
This paper is published in  https://github.com/dk1ri as well

Introduction

This paper describes the reserved token of the MYC protocol.
For more details of the MYC system please check the reference.

Definitions and formats

see http://dk1ri.de/myc/Definitions.pdf

Overview

Every MYC device should provide mandatory reserved command tokens and understand them, if applicable.
The set of announcements of a MYC device should be in numerical sequence, start with the reserved basic command &H00 and end with the other reserved tokens &HxxF0 - &HxxFF. In the full anouncment-list of CR the last line of each device is the I-announcement. This is necessary, to identify commands in systems with hierarchical (stacked) command-routers. Rules lines may follow only.

Eight of the reserved tokens are used and defined now: &H00, &HxxF0, &HxxF1 and &HxxFA - &HxxFF

Basic Command &H00

The one byte &H00 basic command is mandatory for all MYC devices.

The basic announcement is called with the one byte command &H00 or with the &HxxF0 command.
announce:	0;<dt>;MANUFACTURER;DEVICEDESCRIPTION;VERSION;NUMBER_OF_DEVICE;LINELENGTH; COMMAND_BYTES;NUMBER_OF_ANNOUNCELINES

command:	&H00
answer:	<basic announcement>		as string <s>				
info:		-

There is no info. The device can use the &HxxF0 info instead.
The announcement is fixed and therefore the announce-line do not describe the format of the description but is the content, which is transmitted as answer of the command.
The first byte of the answer  is the one byte string-length. The &H00 announcement is limited therefore to 255 Bytes.

MANUFACTURER DEVICEDESCRIPTION and VERSION are combined to a devicegroupname and are used in file names, so not all character are allowed. Preferred is a-z, A-Z, 0-9 _		
These devicegroupnames are unique to a  normal device and its firmware. A (published) device / firmware combination with a devicegroupname must not be changed. If changes are necessary, a new version must be used. Each device with it individualization belongs to a devicegroup. So, this is valid also for controlled programs, but not for controlled CR and and not for all controlling devices.
For a normal device  NUMBER_OF_DEVICES is 1, For CR it is all FU + CR + RU + number given by lower level CR. This value is important for the command-router as info for a higher level CR.
LINELENGTH is the maximum line-length of the announcement lines.
COMMAND_BYTES  is the number of bytes used for commands. Allowed values are 1, 2, 4. Higher numbers are handled as one byte.
NUMBER_OF_ANNOUNCELINES includes rules. This is is the size of the announcement command memory. When the number of devices changes for a CR, it informs all devices except FU about a new announce-list by the &HxxFD info. These devices will run a startup procedure: see Startup behavior in http://dk1ri.de/myc/Description.pdf.
A (translated) &H00 command of a device is answered by the CR itself and not send to the device for answer.

Announcement Command &HxxF0

The &HxxF0 announcement command is mandatory for all MYC devices.

announce:	240;an,ANNOUNCEMENTS,<des>...<des>;<l>;<NUMBER_OF_ANNOUNCELINES>	240 for 1 byte command-token
command:	&HxxF0<n><m>											ask for m announcement lines starting at 
															position n
answer:	<s>[<s>...]
info:		&HxxF0<announce line 0>

<n> is a positional parameter of the memory, the commandtoken of the answer may be different. The number of bytes for <m> and <n> depends on <NUMBER_OF_ANNOUNCELINES>.
<l> is the same as for the basic announcement; it is the maximum length of the string of the memory.  The number of bytes for the string-length 
depends on this.
< NUMBER_OF_ANNOUNCELINES> is the number of the announcement lines including those for the reserved commands, rules and for the  CR the I-lines. Same as in the &H00 command).

The CR will ask for the announce-lists of all devices using the &HxxF0 command, if it do not have other sources. It will replace the &HxxF0 line of these devices by the “in” command when building the complete list. The command-router answers all announcement commands by itself using  the full list with translated command-token. The CR will  not forward &HxxF0 infos.

Devices may be added or may disappear. It is assumed, that this will rarely happen, so that the CR will send a &HxxFD info if the announcement-list changes. These devices will run a startup procedure: see Startup behavior in http://dk1ri.de/myc/Description.pdf.
The CR will not renumber the command-token at that time.
Future versions of the CR may use metacommands to handle disappeared devices.

Announcement Command &HxxF

The &HxxF1 announcement command is used by the CR only.

announce:	241;an,BASIC ANNOUNCEMENTS,<des>...<des>;<n>						241 for 1 byte command-token
command:	&HxxF0<n><m>											ask for basic m announcement lines
															start at n (“0” based)
answer:	<s>
info:		&HxxF1<basic announcelines>

Features Command &HxxFA

This is not a command but a description announcement of optional additional feature and properties of a device-group, which cannot be modified.
This line is optional and not forwarded by the CR, if all <OPTION> are used by the CR only.
The command announcement has the first command-type description  "FEATURE".

announce:	253;ia, FEATURE[,<des>]...[,<des>];<ty>,<OPTION>,[<des>..][;...]
command:	-
Answer	-
info:		-

Defined <OPTION> are:
b,ANSWERTIME,<DEFAULT><,des>	Time (ms) for the CR to wait before asking for an answer, if the CR must poll for a answer (for I2C eg).
						If applicable but not given the default ANSWERTIME is 100ms. For CR only.
						Either option ANSWERTIME or ADDXX can be used 
b,ADDXX,<DEFAULT>			Novalid character during polling. The escape character is $HFF. If the non-valid character is $HFF the 
						escape character is $H01.
						Either option ANSWERTIME or ADDXX can be used.  For CR only.
 						For details see http://dk1ri.de/myc/Definitions.pdf 
b,INFO,<DEFAULT>				FU only. to be defined, if infos are send, must not be defined otherwise
						0:	info used, but no polled interface
						other:	info polling time in 100ms.
						For details see Data transfer in http://dk1ri.de/myc/Description.pdf.

Log on Command &HxxFB

This command is used by the RU only. Used, if the system requires a log on for users to allow all or a subset of commands. The RU will then send a string with “Q” rules to the CR. From this the CR will use a individual list of commands for this user and block all other commands.
For more details see 	http://dk1ri.de/myc/Rules_device.pdf
The command announcement has the command-type description  "LOGON"

announce:	251;ob,LOGON[,<des>];<b>,mode;<s>,name;<s>,password
mode:	1	log out							password: any <s>
	2	log on
	3	switch on user management (admin only)
	4	switch off user management (admin only)		password: any <s>
command:	&HxxFB&H00&H03<mode><name><password>
answer		“Q” rule
info		-

Last Error Command &HxxFC

This command is mandatory for FU and delivers the last error the device detected. 
The command announcement has the command-type description  "LAST ERROR" to identify them in a list with the translated command-token, which is sent by the command-router.
announce:	252;aa,LAST ERROR[,<des>];<s><,des>
command	&HxxFC
answer		<s>
The format of the string is not defined.

Administrative Data Command &HxxFD

This command deliver administrative data of the device.
Multiple <OPTION> are addressed by position.
The command announcement has the command-type description  "MYC INFO".

announce:	253;aa,MYC INFO[,<des>]...[,<des>];<ty>,<OPTION>,[<des>..][;...}
command:	&HxxFD<m>			<n> omitted for one element array
Answer	<s>|<n>			example
info:		253<m><s>|<n>		send info of position m

defines<OPTION>		Values:
b,ACTIVE					mandatory
				03		busy
				04		ready and active
				other <n>	try again in <n> seconds	
b,ANNOUNCELIST		<n>		(new) list <n> available; for CR only				
more  to be defined

Individualization Commands &HxxFE and &HxxFF

The individualization commands are mandatory for all devices except some SK.
CR has 2 “in” commands instead.
These commands write and read the individual properties of a device as names and number This differentiates different devices of the same device-group in a system. It also provide properties of the communication with the command-router.
Also configuration parameters for selecting hardware variation should be stored here, if wrong configuration may cause malfunction.
The command announcements have the command-type description  "INDIVIDUALISATION.

For security reasons, the &HxxFE command is replaced by the “in” command (no action) in the complete command-list, which is generated by the CR. So these properties are not written during normal usage. They can be written for individualization before the normal usage.
The SK may need some individual data as the name for proper labeling. It must differenciate  identical commands  of devices with the same device-type. It will use the I-announcement, which is described in I-announcements below. The command is replaced by the “in” command as well.
The CR will not change the command-tokens during runtime,  but may do this at new start,  if the sequence of devices within the config file of the CR is modified or lower level CR deliver different data. 

It is not necessary that all of the readable properties  are writable as well.
At start up the CR must know the individual communication properties for the devices, which therefore must be stored locally. The CR will not connect to unknown devices.

announce:	254;oa,INDIVIDUALISATION[,des];<ty>,<OPTION>,<DEFAULT>[,<des>]..	
command	254<m><data>							<m> is the sequence number of the OPTION (0 based)
answer		-
info:		-
announce:	255;aa,INDIVIDUALISATION[,des];<ty>,<OPTION>,<DEFAULT>[,<des>]..	
command	255<m>								<m> is the sequence number of the OPTION (0 based))
answer		<data>
info:		255<m><data>							parameter <m>

The following is a list of defined command-properties and values; This list is not complete; updates may follow.
Because there may be hardware variations, many keywords may appear. Please try to use standardized, english, names,
For multiple interfaces <OPTION>s for each interface must be grouped together and start with the interface-type as USB, TELNET,....
The interfaces are the “listen” interface, where commands are accepted. So SK has no interface mentioned.
A device with multiple interfaces may have not all interfaces active, depending on hardware variants with the same firmware. This will be defined by a bit during individualization. A device will ignore inputs from deactivated interfaces except for the &HxxFE command.
A <DEFAULT> is mandatory where given. 

OPTION>							comment:
<l>,NAME,<DEFAULT>					actual name, mandatory write/read; < 256 characters
<n>,NUMBER,<DEFAULT>				actual number, mandatory write/read
<n>,DISPLAYSIZE,<DEFAULT>,{<size1>,..}		<DEFAULT> is positional parameter of sizex
								<sizex> something like 16x2, 1024p
<a>,I2C|RS232|CAN|RC5|RC6| 				
USB|TELNET|HTTP|HTTPS|TERMINAL|			Multiple interfaces start with one of these types, followed by the other parameters.
SSH|RADIO,<DEFAULT>					0: not active; 1:  active

Defined Interfaces:

 <a>,I2C;<DEFAULT>;
 b,ADRESS,<DEFAULT>{1 to 127}			{1 to 127}, mandatory

<a>RS232,<DEFAULT>;
 b.BAUDRATE,<DEFAULT>,{auto,19200,...}		Baudrate, optional
 3,NUMBER_OF_BITS,{8N1}				something like this, optional
 b,COMPORT							COM Port number, optional

 <a>,TELNET,<DEFAULT>;				server !!
<a>,SSH,<DEFAULT>					server !!
 w,PORT							portnumber, optional
<s>,ADRESS							IP adress or DNS Name, mandatory						
 b,TIMEOUT,<default>					Timeout, optional				

<a>,HTTP,<DEFAULT>;					server !!
<s>,ADRESS							madatory
b,TIMEOUT,<DEFAULT>					Timeout (optional)

<a>,Terminal,<DEFAULT>;					usually for CR only, interface, from where the program is called, no other options.

<a>,USB,<DEFAULT>;					slave

 <a>,RC5,<DEFAULT>;
 b,ADRESS,<DEFAULT>,{1 to 32}				mandatory
 <a>,RC6,<DEFAULT>;
b,ADRESS,<DEFAULT>,{1 to 64}				mandatory

<a>,CAN,<DEFAULT>;
 b,ADRESS,<DEFAULT>

<a>RADIO,<DEFAULT>					Wireless interface
;
I-announcements

I-announcements are created by the CR and used in the full announce-list.
They are appended after the announcements of each device.
The format is:
I;command-router_name;device_type;device_name;device_number

command-router_name is the name of the  command-route, where the device is located. The name must be unique in a multi level MYC system
Name and number of the device are defined during individualization or are default. 
The device-type is the combination of MANUFACTURER DEVICEDESCRIPTION VERSION. Together eith name and number it must be unique with each MYC system.





Copyright	

Dieses Dokument darf unverändert kopiert werden.
Die Ideen in diesem Dokument unterliegen der GPL (Gnu Public Licence,V2) soweit keine früheren, anderen Rechte betroffen sind.
Die Verwendung der Unterlagen erfolgt auf eigene Gefahr; es wird keinerlei Garantie übernommen.
This document can be copied without changes.
The ideas of this document can be used under GPL (Gnu Public License, V2) as long as no earlier other rights are affected.
The usage of this document is on own risk, there is no warranty.

Reference

[1]	http://dk1ri.de/myc/MYC.pdf  (german)
[2]	http://dk1ri.de/myc/MYC_en.pdf
[3]	http://dk1ri.de/myc/Description.pdf
[4]	http://dk1ri.de/myc/commands.pdf
[5]	http://dk1ri.de/myc/Reserved_tokens.pdf
[6]	http://dk1ri.de/myc/Rules.pdf
[7]	http://dk1ri.de/myc/commandrouter.pdf
[8]	http://dk1ri.de/myc/Rules_device.pdf
[9]	http://dk1ri.de/myc/skin.pdf
[10]	http://dk1ri.de/myc/logicdevice.pdf
[11]	http://dk1ri.de/myc/Definitions.pdf
